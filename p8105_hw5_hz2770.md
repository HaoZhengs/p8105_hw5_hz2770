p8105\_hw5\_hz2770
================
Hao Zheng
11/16/2021

``` r
library(tidyverse)
```

    ## -- Attaching packages --------------------------------------- tidyverse 1.3.1 --

    ## v ggplot2 3.3.5     v purrr   0.3.4
    ## v tibble  3.1.4     v dplyr   1.0.7
    ## v tidyr   1.1.3     v stringr 1.4.0
    ## v readr   2.0.1     v forcats 0.5.1

    ## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
    ## x dplyr::filter() masks stats::filter()
    ## x dplyr::lag()    masks stats::lag()

``` r
# read the csv
homicide_data = read.csv("./data/homicide_data.csv")
```

## Problem 1

The dataset contains 52179 homicide cases and 12 variables including the
date, victim’s demographic information, city, state, precise longitude
and latitude, and disposition status.

Then we create a new variable called `city_state`, and show the number
of all homicides and unsolved homicides in each `city_state`.

``` r
homicide_data = 
  homicide_data %>% 
  unite("city_state", city, state, sep = ", ")

summary_data = 
  homicide_data %>% 
  group_by(city_state) %>% 
  summarise(
    total_homicides = n(),
    unsolved_homicides = sum(disposition %in% c("Closed without arrest", "Open/No arrest"))
  )

knitr::kable(summary_data)
```

| city\_state        | total\_homicides | unsolved\_homicides |
|:-------------------|-----------------:|--------------------:|
| Albuquerque, NM    |              378 |                 146 |
| Atlanta, GA        |              973 |                 373 |
| Baltimore, MD      |             2827 |                1825 |
| Baton Rouge, LA    |              424 |                 196 |
| Birmingham, AL     |              800 |                 347 |
| Boston, MA         |              614 |                 310 |
| Buffalo, NY        |              521 |                 319 |
| Charlotte, NC      |              687 |                 206 |
| Chicago, IL        |             5535 |                4073 |
| Cincinnati, OH     |              694 |                 309 |
| Columbus, OH       |             1084 |                 575 |
| Dallas, TX         |             1567 |                 754 |
| Denver, CO         |              312 |                 169 |
| Detroit, MI        |             2519 |                1482 |
| Durham, NC         |              276 |                 101 |
| Fort Worth, TX     |              549 |                 255 |
| Fresno, CA         |              487 |                 169 |
| Houston, TX        |             2942 |                1493 |
| Indianapolis, IN   |             1322 |                 594 |
| Jacksonville, FL   |             1168 |                 597 |
| Kansas City, MO    |             1190 |                 486 |
| Las Vegas, NV      |             1381 |                 572 |
| Long Beach, CA     |              378 |                 156 |
| Los Angeles, CA    |             2257 |                1106 |
| Louisville, KY     |              576 |                 261 |
| Memphis, TN        |             1514 |                 483 |
| Miami, FL          |              744 |                 450 |
| Milwaukee, wI      |             1115 |                 403 |
| Minneapolis, MN    |              366 |                 187 |
| Nashville, TN      |              767 |                 278 |
| New Orleans, LA    |             1434 |                 930 |
| New York, NY       |              627 |                 243 |
| Oakland, CA        |              947 |                 508 |
| Oklahoma City, OK  |              672 |                 326 |
| Omaha, NE          |              409 |                 169 |
| Philadelphia, PA   |             3037 |                1360 |
| Phoenix, AZ        |              914 |                 504 |
| Pittsburgh, PA     |              631 |                 337 |
| Richmond, VA       |              429 |                 113 |
| Sacramento, CA     |              376 |                 139 |
| San Antonio, TX    |              833 |                 357 |
| San Bernardino, CA |              275 |                 170 |
| San Diego, CA      |              461 |                 175 |
| San Francisco, CA  |              663 |                 336 |
| Savannah, GA       |              246 |                 115 |
| St. Louis, MO      |             1677 |                 905 |
| Stockton, CA       |              444 |                 266 |
| Tampa, FL          |              208 |                  95 |
| Tulsa, AL          |                1 |                   0 |
| Tulsa, OK          |              583 |                 193 |
| Washington, DC     |             1345 |                 589 |

Then we perform a prop.test for the city Baltimore, MD,

``` r
baltimore =
  summary_data %>% 
  filter(city_state == "Baltimore, MD")

balt_prop =
  prop.test(
    x = pull(baltimore, unsolved_homicides),
    n = pull(baltimore, total_homicides)
  ) %>% 
  broom::tidy()

balt_prop
```

    ## # A tibble: 1 x 8
    ##   estimate statistic  p.value parameter conf.low conf.high method    alternative
    ##      <dbl>     <dbl>    <dbl>     <int>    <dbl>     <dbl> <chr>     <chr>      
    ## 1    0.646      239. 6.46e-54         1    0.628     0.663 1-sample~ two.sided

``` r
pull(balt_prop, estimate)
```

    ##         p 
    ## 0.6455607

``` r
pull(balt_prop, conf.low)
```

    ## [1] 0.6275625

``` r
pull(balt_prop, conf.high)
```

    ## [1] 0.6631599

Now, we can perform `prop.test` for every city, and get the estimate
proportion and confidence interval.

``` r
city_prop = 
  summary_data %>% 
  mutate(
    prop_test = map2(.x = unsolved_homicides, .y = total_homicides, ~prop.test(x = .x, n = .y)),
    tidy_test = map(.x = prop_test, ~broom::tidy(.x))
  ) %>% 
  select(-prop_test) %>% 
  unnest(tidy_test) %>% 
  select(city_state, estimate, conf.low, conf.high)
```

    ## Warning in prop.test(x = .x, n = .y): Chi-squared approximation may be incorrect

Create a plot to show above results.

``` r
city_prop %>% 
  mutate(
    city_state = fct_reorder(city_state, estimate)
  ) %>% 
  ggplot(aes(x = city_state, y = estimate)) +
  geom_point() +
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high)) +
  coord_flip() +
  labs(
    x = "city",
    y = "estimate",
    title = "Estimates and CIs for unsolved proportions across different cities"
  )
```

![](p8105_hw5_hz2770_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->

## Problem 2
